<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VTX Range Calculator</title>

<style>
:root{
  --bg:#0d1117;
  --card:#161b22;
  --accent:#00e5ff;
  --text:#e6edf3;
  --muted:#9aa4ad;
  --radius:16px;
}
body{
  margin:0;
  font-family: system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:14px;
  text-align:center;
  background:#020409;
  font-size:1.2rem;
  font-weight:bold;
}
.container{
  padding:12px;
  max-width:480px;
  margin:auto;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 20px rgba(0,0,0,.4);
}
label{
  font-size:.9rem;
  color:var(--muted);
}
input,select{
  width:100%;
  padding:12px;
  margin-top:4px;
  border-radius:12px;
  border:none;
  background:#0d1117;
  color:white;
  font-size:1rem;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:var(--accent);
  color:#000;
  font-size:1.1rem;
  font-weight:bold;
  margin-top:10px;
}
.result{
  font-size:1.2rem;
  font-weight:bold;
  color:var(--accent);
}
.small{
  font-size:.85rem;
  color:var(--muted);
}
.model-help{
  font-size:.85rem;
  margin-top:6px;
  line-height:1.4;
}
</style>
</head>

<body>
<header>üì° VTX Range Calculator</header>

<div class="container">

<div class="card">
<label>Power (mW)</label>
<input type="number" id="power_mw" value="200">

<label>Frequency (MHz)</label>
<input type="number" id="freq_mhz" value="5800">

<label>TX Gain (dBi)</label>
<input type="number" id="tx_gain_db" value="2">

<label>RX Gain (dBi)</label>
<input type="number" id="rx_gain_db" value="2">

<label>Receiver Sensitivity (dBm)</label>
<input type="number" id="rx_sens_dbm" value="-90">

<label>Fade Margin (dB)</label>
<input type="number" id="margin_db" value="10">
</div>

<div class="card">
<label>Propagation Model</label>
<select id="model">
  <option value="fspl">Free Space (ITU-R)</option>
  <option value="two_ray">Two-Ray Ground</option>
  <option value="hata">Okumura-Hata</option>
  <option value="itu_simple">ITU Simple</option>
</select>

<div class="model-help" id="modelHelp">
Free-space: ‡πÉ‡∏ä‡πâ LOS ‡πÇ‡∏•‡πà‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á
</div>

<label>TX Height (m)</label>
<input type="number" id="ht_m" value="0.03" step="0.01">

<label>RX Height (m)</label>
<input type="number" id="hr_m" value="1.5" step="0.1">

<div id="hataRow" style="display:none">
<label>City Type</label>
<select id="city_type">
  <option value="urban">Urban</option>
  <option value="suburban">Suburban</option>
  <option value="rural">Rural</option>
</select>
</div>

<div id="terrainRow" style="display:none">
<label>Terrain</label>
<select id="terrain">
  <option value="land">Land</option>
  <option value="urban">Urban</option>
  <option value="forest">Forest</option>
</select>
</div>

<button onclick="calc()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞</button>
</div>

<div class="card">
<div class="small">Estimated Distance</div>
<div class="result" id="dist">‚Äî</div>

<div class="small">Path Loss</div>
<div class="result" id="pl">‚Äî</div>

<div class="small">RX Power</div>
<div class="result" id="rx">‚Äî</div>
</div>

<div class="card small">
<b>Model Explanation</b>
<pre id="detail">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</pre>
</div>

</div>

<script>
const help={
 fspl:"Free-space (ITU-R): LOS ‡πÇ‡∏•‡πà‡∏á ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
 two_ray:"Two-ray: ‡∏£‡∏ß‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡∏≤‡∏ï‡πà‡∏≥",
 hata:"Okumura-Hata: ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏±‡∏Å‡∏©‡πå 150‚Äì1500 MHz",
 itu_simple:"ITU simple: FSPL + ‡∏Ñ‡πà‡∏≤‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°"
};

document.getElementById("model").addEventListener("change",e=>{
 const v=e.target.value;
 document.getElementById("modelHelp").textContent=help[v];
 document.getElementById("hataRow").style.display=(v==="hata")?"block":"none";
 document.getElementById("terrainRow").style.display=(v==="itu_simple")?"block":"none";
});

async function calc(){
 const data=new URLSearchParams();
 ["power_mw","freq_mhz","tx_gain_db","rx_gain_db","rx_sens_dbm","margin_db",
  "model","ht_m","hr_m","city_type","terrain"].forEach(id=>{
   const el=document.getElementById(id);
   if(el) data.append(id,el.value);
 });

 const r=await fetch("/vtx-calc",{method:"POST",body:data});
 const j=await r.json();

 if(!j.ok){ alert("Error"); return; }

 document.getElementById("dist").textContent=j.results.estimated_distance_m+" m";
 document.getElementById("pl").textContent=j.results.path_loss_db_at_distance+" dB";
 document.getElementById("rx").textContent=j.results.rx_dbm_at_distance+" dBm";

 document.getElementById("detail").textContent=
 `Model: ${j.inputs.model}
Allowed Path Loss: ${j.results.allowed_path_loss_db} dB
TX dBm: ${j.inputs.tx_dbm}
RX dBm: ${j.results.rx_dbm_at_distance}`;
}
</script>

</body>
</html>