{% extends "partials/header.html" %}{% block content %}
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPM Filter Calculator ‚Äî ConfigDoctor</title>
<style>
:root{--accent:#FF6B2B;--dark:#0F1117;--panel:#1A1D27;--border:#2E3348;--text:#E2E8F0;--muted:#8A94A6;--danger:#EF4444;--warning:#F59E0B;--ok:#22C55E;}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--dark);color:var(--text);padding:2rem 1rem;}
.wrap{max-width:900px;margin:0 auto;}
h1{font-size:1.8rem;font-weight:700;color:var(--accent);margin-bottom:.3rem;}
h2{font-size:1.1rem;font-weight:600;color:#fff;margin:1.8rem 0 .8rem;}
.subtitle{color:var(--muted);margin-bottom:1.8rem;font-size:.95rem;}
.card{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:1.25rem 1.5rem;margin:.8rem 0;}
.form-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;}
@media(max-width:640px){.form-grid{grid-template-columns:1fr;}}
label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:.4rem;}
input,select{width:100%;padding:.6rem .9rem;background:#0d1117;border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:.95rem;}
input:focus,select:focus{outline:2px solid var(--accent);border-color:transparent;}
.btn{background:var(--accent);color:#fff;border:none;padding:.7rem 1.8rem;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem;margin-top:1rem;}
.btn:hover{opacity:.9;}
table{width:100%;border-collapse:collapse;margin:.5rem 0;}
th{background:#252938;color:#fff;padding:.5rem .8rem;font-size:.83rem;text-align:center;}
td{padding:.45rem .8rem;border-bottom:1px solid var(--border);font-size:.85rem;text-align:center;}
.hz-1{color:var(--ok);}
.hz-2{color:#60a5fa;}
.hz-3{color:#c084fc;}
.hz-4{color:var(--warning);}
.cli-box{background:#0d1117;border:1px solid var(--border);border-radius:8px;padding:1rem 1.2rem;font-family:'Courier New',monospace;font-size:.85rem;color:#79c0ff;white-space:pre-wrap;margin:.5rem 0;}
.tag-ok{background:#14532d;color:#86efac;padding:.15rem .5rem;border-radius:4px;font-size:.78rem;font-weight:600;}
.tag-warn{background:#78350f;color:#fde68a;padding:.15rem .5rem;border-radius:4px;font-size:.78rem;font-weight:600;}
.rec-box{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.8rem;margin:.8rem 0;}
.rec-item{background:#0d1117;border:1px solid var(--border);border-radius:8px;padding:.8rem;text-align:center;}
.rec-val{font-size:1.4rem;font-weight:700;color:var(--accent);}
.rec-label{font-size:.78rem;color:var(--muted);margin-top:.2rem;}
.warn-item{background:#78350f22;border:1px solid #78350f;border-radius:6px;padding:.6rem 1rem;margin:.4rem 0;font-size:.88rem;color:#fde68a;}
.note-item{color:var(--muted);font-size:.85rem;padding:.25rem 0;}
.copy-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:.3rem .7rem;border-radius:5px;cursor:pointer;font-size:.8rem;float:right;}
.copy-btn:hover{color:#fff;border-color:var(--accent);}
</style>
</head>
<body>
<div class="wrap">
  <h1>üîî RPM Filter Frequency Calculator</h1>
  <p class="subtitle">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà harmonic notch ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RPM filter ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ dyn_notch_min/max ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>

  <div class="card">
    <form method="POST" action="/rpm-filter">
      <div class="form-grid">
        <div>
          <label>Motor KV</label>
          <input type="number" name="kv" min="200" max="8000" value="{{ form.kv or 2400 }}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2400" required>
        </div>
        <div>
          <label>Battery (S)</label>
          <select name="battery">
            {% for s in ['3S','4S','5S','6S','7S','8S'] %}
            <option value="{{ s }}" {% if form.battery == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Prop Size (‡∏ô‡∏¥‡πâ‡∏ß)</label>
          <select name="prop_size">
            {% for p in [2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5, 6.0, 7.0, 8.0] %}
            <option value="{{ p }}" {% if form.prop_size|float == p %}selected{% endif %}>{{ p }}"</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <button class="btn" type="submit">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì RPM Filter ‚Üí</button>
    </form>
  </div>

  {% if result %}
  <h2>üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äî KV {{ result.kv }} √ó {{ result.cells }}S</h2>

  {% if result.warnings %}
  {% for w in result.warnings %}
  <div class="warn-item">{{ w }}</div>
  {% endfor %}
  {% endif %}

  <div class="card">
    <h2 style="margin-top:0">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà Harmonic ‡∏ï‡∏≤‡∏° Throttle</h2>
    <p style="color:var(--muted);font-size:.85rem;margin-bottom:.8rem">RPM loaded max: <strong style="color:var(--accent)">{{ "{:,}".format(result.rpm_loaded_max) }} RPM</strong> &nbsp;|&nbsp; ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà 1√ó ‡∏ó‡∏µ‡πà full throttle: <strong style="color:var(--ok)">{{ result.throttle_table[-1].harmonics[0].hz }} Hz</strong></p>
    <table>
      <tr>
        <th>Throttle</th>
        <th>RPM (est.)</th>
        <th class="hz-1">1√ó Hz</th>
        <th class="hz-2">2√ó Hz</th>
        <th class="hz-3">3√ó Hz</th>
        <th class="hz-4">4√ó Hz</th>
      </tr>
      {% for row in result.throttle_table %}
      <tr>
        <td><strong>{{ row.throttle }}</strong></td>
        <td>{{ "{:,}".format(row.rpm) }}</td>
        {% for h in row.harmonics %}
        <td class="hz-{{ h.n }}">{{ h.hz }} Hz</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </table>
  </div>

  <div class="card">
    <h2 style="margin-top:0">üéØ ‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Betaflight</h2>
    <div class="rec-box">
      <div class="rec-item">
        <div class="rec-val">{{ result.recommended.dyn_notch_min }}</div>
        <div class="rec-label">dyn_notch_min_hz</div>
      </div>
      <div class="rec-item">
        <div class="rec-val">{{ result.recommended.dyn_notch_max }}</div>
        <div class="rec-label">dyn_notch_max_hz</div>
      </div>
      <div class="rec-item">
        <div class="rec-val">{{ result.recommended.dyn_notch_count }}</div>
        <div class="rec-label">dyn_notch_count</div>
      </div>
    </div>
    <p style="color:var(--muted);font-size:.85rem;">‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° harmonic 1√ó ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà throttle 20%‚Äì100% + margin 20% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
  </div>

  <div class="card">
    <h2 style="margin-top:0">üìã CLI Commands (copy ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Betaflight)</h2>
    <button class="copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('cli-output').textContent)">üìã Copy</button>
    <div class="cli-box" id="cli-output">{% for line in result.cli_commands %}{{ line }}
{% endfor %}</div>
  </div>

  <div class="card">
    <h2 style="margin-top:0">‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h2>
    {% for note in result.notes %}
    <p class="note-item">‚Ä¢ {{ note }}</p>
    {% endfor %}
  </div>
  {% endif %}

  <div class="card" style="border-color:var(--border)">
    <p style="color:var(--muted);font-size:.85rem;">üí° <strong style="color:var(--text)">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ dyn_notch_min/max ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î RPM Filter ‡πÉ‡∏ô Betaflight Configurator ‚Üí Filters tab ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Blackbox + Spectrum Analyzer ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
  </div>

  <p style="margin-top:1.5rem;"><a href="/app" style="color:var(--accent)">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏•‡∏±‡∏Å</a></p>
</div>
</body>
</html>
{% endblock %}
