<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPM Filter Calculator ‚Äî OBIXConfig Doctor</title>
{% set og_title       = "RPM Filter Calculator ‚Äî OBIXConfig Doctor" %}
{% set og_description = "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì harmonic frequency ‡πÅ‡∏•‡∏∞ dyn_notch ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏à‡∏≤‡∏Å KV ‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÅ‡∏ö‡∏ï" %}
{% set og_url         = "https://configdoctor.onrender.com/rpm-filter" %}
{% include "partials/og_tags.html" %}
<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<style>
.rpm-wrap{max-width:900px;margin:0 auto;padding:16px;}
.rpm-card{background:var(--card-bg,#0d2015);border:1px solid var(--border,#1a3a24);border-radius:12px;padding:22px;margin:14px 0;}
.rpm-card h3{color:var(--green,#10c47a);font-size:1rem;margin-bottom:14px;}
.form-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
@media(max-width:600px){.form-grid{grid-template-columns:1fr;}}
label{font-size:.82rem;color:var(--muted,#7a9a88);display:block;margin-bottom:5px;}
input,select{width:100%;padding:.55rem .85rem;background:#050d08;border:1px solid var(--border,#1a3a24);border-radius:7px;color:var(--fg,#e0f0e8);font-size:.9rem;}
input:focus,select:focus{outline:2px solid var(--green,#10c47a);border-color:transparent;}
.submit-btn{margin-top:14px;background:var(--green,#10c47a);color:#021a0e;border:none;border-radius:8px;padding:10px 26px;font-weight:700;cursor:pointer;font-size:.95rem;}
.submit-btn:hover{opacity:.88;}
table{width:100%;border-collapse:collapse;}
th{background:#061309;color:var(--muted,#7a9a88);padding:.5rem .8rem;font-size:.8rem;text-align:center;border-bottom:1px solid var(--border,#1a3a24);}
td{padding:.5rem .8rem;border-bottom:1px solid #0d1a10;font-size:.85rem;text-align:center;}
tr:hover td{background:#061309;}
.hz1{color:#10c47a;font-weight:600;}
.hz2{color:#60a5fa;}
.hz3{color:#c084fc;}
.hz4{color:#f59e0b;}
.rec-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:10px 0;}
.rec-item{background:#050d08;border:1px solid var(--border,#1a3a24);border-radius:10px;padding:14px;text-align:center;}
.rec-val{font-size:1.5rem;font-weight:700;color:var(--green,#10c47a);}
.rec-lbl{font-size:.75rem;color:var(--muted,#7a9a88);margin-top:4px;}
.cli-box{background:#050d08;border:1px solid #1a3a24;border-radius:8px;padding:14px;font-family:monospace;font-size:.82rem;color:#10c47a;white-space:pre;overflow-x:auto;}
.copy-btn{background:transparent;border:1px solid var(--border,#1a3a24);color:var(--muted,#7a9a88);padding:.3rem .75rem;border-radius:6px;cursor:pointer;font-size:.8rem;float:right;}
.copy-btn:hover{color:var(--fg,#e0f0e8);border-color:var(--green,#10c47a);}
.warn-box{background:#1a0a0033;border:1px solid #7c2d12;border-radius:8px;padding:10px 14px;margin:6px 0;color:#fde68a;font-size:.85rem;}
.note-item{color:var(--muted,#7a9a88);font-size:.84rem;padding:.2rem 0;}
.legend{display:flex;gap:16px;flex-wrap:wrap;font-size:.82rem;margin-bottom:10px;}
.leg{display:inline-flex;align-items:center;gap:6px;color:var(--muted,#7a9a88);}
.dot{width:12px;height:12px;border-radius:3px;display:inline-block;}
a.back{color:var(--green,#10c47a);font-size:.85rem;text-decoration:none;}
</style>
</head>
<body>
<div class="top-bar">
  <div class="top-left">
    <a href="/landing"><img src="{{ url_for('static', filename='img/obix-logo.png') }}" class="logo" alt="OBIXConfig Doctor"></a>
  </div>
  <button class="toggle-theme" onclick="toggleTheme()" title="‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°">üåó</button>
</div>

<div class="rpm-wrap">
  <div style="margin-bottom:16px;">
    <a class="back" href="/app">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    <h2 style="color:var(--green);font-size:1.1rem;margin:6px 0 2px;">üîî RPM Filter Frequency Calculator</h2>
    <p style="color:var(--muted);font-size:.84rem;">‡πÉ‡∏™‡πà KV + ‡πÅ‡∏ö‡∏ï ‚Üí ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á harmonic + ‡∏Ñ‡πà‡∏≤ dyn_notch ‡∏û‡∏£‡πâ‡∏≠‡∏° CLI command</p>
  </div>

  <div class="rpm-card">
    <h3>‚öôÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå</h3>
    <form method="POST" action="/rpm-filter">
      <div class="form-grid">
        <div>
          <label>Motor KV</label>
          <input type="number" name="kv" min="200" max="8000" value="{{ form.kv or 2400 }}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2400" required>
        </div>
        <div>
          <label>Battery</label>
          <select name="battery">
            {% for s in ['3S','4S','5S','6S','7S','8S'] %}
            <option value="{{ s }}" {% if form.battery == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Prop Size (‡∏ô‡∏¥‡πâ‡∏ß)</label>
          <select name="prop_size">
            {% for p in [2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5, 6.0, 7.0, 8.0] %}
            <option value="{{ p }}" {% if form.prop_size and form.prop_size|float == p %}selected{% endif %}>{{ p }}"</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <button class="submit-btn" type="submit">üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì RPM Filter ‚Üí</button>
    </form>
  </div>

  {% if result %}
    {% if result.error is defined %}
    <div class="warn-box">‚ùå {{ result.error }}</div>
    {% else %}

    {% for w in result.warnings %}
    <div class="warn-box">{{ w }}</div>
    {% endfor %}

    <div class="rpm-card">
      <h3>üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Harmonic Frequency</h3>
      <p style="color:var(--muted);font-size:.83rem;margin-bottom:10px;">
        Max RPM (loaded): <strong style="color:var(--green);">{{ "{:,}".format(result.rpm_loaded_max) }} RPM</strong> &nbsp;¬∑&nbsp;
        Freq ‡∏ó‡∏µ‡πà full throttle (1√ó): <strong style="color:var(--green);">{{ result.throttle_table[-1].harmonics[0].hz }} Hz</strong>
      </p>
      <div class="legend">
        <span class="leg"><span class="dot" style="background:#10c47a"></span> 1√ó fundamental</span>
        <span class="leg"><span class="dot" style="background:#60a5fa"></span> 2√ó harmonic</span>
        <span class="leg"><span class="dot" style="background:#c084fc"></span> 3√ó harmonic</span>
        <span class="leg"><span class="dot" style="background:#f59e0b"></span> 4√ó harmonic</span>
      </div>
      <table>
        <tr>
          <th>Throttle</th><th>RPM (est.)</th>
          <th class="hz1">1√ó Hz</th><th class="hz2">2√ó Hz</th><th class="hz3">3√ó Hz</th><th class="hz4">4√ó Hz</th>
        </tr>
        {% for row in result.throttle_table %}
        <tr>
          <td><strong>{{ row.throttle }}</strong></td>
          <td>{{ "{:,}".format(row.rpm) }}</td>
          {% for h in row.harmonics %}
          <td class="hz{{ h.n }}">{{ h.hz }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </table>
    </div>

    <div class="rpm-card">
      <h3>üéØ ‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Betaflight</h3>
      <div class="rec-grid">
        <div class="rec-item"><div class="rec-val">{{ result.recommended.dyn_notch_min }}</div><div class="rec-lbl">dyn_notch_min_hz</div></div>
        <div class="rec-item"><div class="rec-val">{{ result.recommended.dyn_notch_max }}</div><div class="rec-lbl">dyn_notch_max_hz</div></div>
        <div class="rec-item"><div class="rec-val">{{ result.recommended.dyn_notch_count }}</div><div class="rec-lbl">dyn_notch_count</div></div>
      </div>
    </div>

    <div class="rpm-card">
      <h3>üìã CLI Commands <button class="copy-btn" onclick="copyCLI()">üìã Copy</button></h3>
      <div class="cli-box" id="cli-out">{% for line in result.cli_commands %}{{ line }}
{% endfor %}</div>
    </div>

    <div class="rpm-card">
      <h3>‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h3>
      {% for note in result.notes %}
      <p class="note-item">‚Ä¢ {{ note }}</p>
      {% endfor %}
    </div>
    {% endif %}
  {% endif %}

  <p style="margin-top:16px;font-size:.82rem;color:var(--muted);">
    üí° ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ Blackbox + Betaflight Spectrum Analyzer ‡πÄ‡∏™‡∏°‡∏≠ ‚Äî ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  </p>
</div>

<script>
(function(){ var t=localStorage.getItem('theme')||'dark'; document.documentElement.className=t; document.addEventListener('DOMContentLoaded',function(){ document.body.classList.add(t); }); })();
function toggleTheme(){ var isDark=document.body.classList.contains('dark'); document.body.classList.toggle('dark',!isDark); document.body.classList.toggle('light',isDark); localStorage.setItem('theme',isDark?'light':'dark'); }
function copyCLI(){ var el=document.getElementById('cli-out'); if(!el) return; navigator.clipboard.writeText(el.textContent).then(function(){ showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å CLI command ‡πÅ‡∏•‡πâ‡∏ß ‚úì'); }); }
function showToast(msg){ var t=document.getElementById('toast'); if(!t){ t=document.createElement('div'); t.id='toast'; t.style.cssText='position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#10c47a;color:#021a0e;padding:8px 18px;border-radius:20px;font-weight:700;font-size:.87rem;z-index:999;'; document.body.appendChild(t); } t.textContent=msg; t.style.opacity='1'; clearTimeout(t._t); t._t=setTimeout(function(){ t.style.opacity='0'; },2200); }
</script>
</body>
</html>
