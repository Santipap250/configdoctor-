<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>The CLI Surgeon - ConfigDoctor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>ü©∫ The CLI Surgeon</h1>
    <p>‡∏ß‡∏≤‡∏á‡∏ú‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á <code>diff all</code> ‡∏´‡∏£‡∏∑‡∏≠ <code>dump</code> ‡∏à‡∏≤‡∏Å Betaflight ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <b>Analyze</b></p>

    <textarea id="cliDump" rows="14" style="width:100%;" placeholder="‡∏ß‡∏≤‡∏á diff all / dump ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>

    <div style="margin-top:10px;">
      <button id="analyzeBtn">Analyze</button>
      <button id="clearBtn">Clear</button>
    </div>

    <div id="result" style="margin-top:12px; white-space:pre-wrap; background:#0f0f10; padding:12px; border-radius:8px;"></div>
  </div>

<script>
document.getElementById('clearBtn').addEventListener('click', () => {
  document.getElementById('cliDump').value = '';
  document.getElementById('result').textContent = '';
});
document.getElementById('analyzeBtn').addEventListener('click', async () => {
  const dump = document.getElementById('cliDump').value.trim();
  if (!dump) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á diff all / dump ‡∏Å‡πà‡∏≠‡∏ô'); return; }
  document.getElementById('result').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...';
  try {
    const r = await fetch('/analyze_cli', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({dump})
    });
    const j = await r.json();
    if (j.error) document.getElementById('result').textContent = 'Error: ' + j.error;
    else {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
      let out = '';
      if (j.summary) out += j.summary + '\n\n';
      if (j.rules && j.rules.length) {
        out += '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:\n';
        j.rules.forEach((rs, i) => {
          out += `${i+1}. [${rs.level.toUpperCase()}] ${rs.msg}\n   => ${rs.suggestion}\n\n`;
        });
      }
      if (j.fix_commands && j.fix_commands.length) {
        out += '‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á CLI ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (copy ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Betaflight CLI):\n';
        out += j.fix_commands.join('\n') + '\n';
      }
      document.getElementById('result').textContent = out || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏ç‡πà';
    }
  } catch (e) {
    document.getElementById('result').textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message;
  }
});
</script>
</body>
</html>