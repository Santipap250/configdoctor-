<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Obixconfig Doctor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --bg-color-light: #f5f5f5;
    --text-color-light: #111;
    --card-color-light: #fff;

    --bg-color-dark: #121212;
    --text-color-dark: #eee;
    --card-color-dark: #1e1e1e;
}

body.light {
    background-color: var(--bg-color-light);
    color: var(--text-color-light);
}

body.light .container, body.light .form-card, body.light .result-card {
    background-color: var(--card-color-light);
}

body.dark {
    background-color: var(--bg-color-dark);
    color: var(--text-color-dark);
}

body.dark .container, body.dark .form-card, body.dark .result-card {
    background-color: var(--card-color-dark);
}

button.toggle-theme {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 6px 12px;
    cursor: pointer;
}
</style>

<script>
function copyText(id) {
    const text = document.getElementById(id).innerText;
    navigator.clipboard.writeText(text);
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Betaflight ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß");
}

// Dark/Light toggle
function toggleTheme() {
    document.body.classList.toggle('dark');
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}

window.onload = () => {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.classList.add(savedTheme);
}

function toggleConcept() {
  const box = document.querySelector('.concept-box');
  box.classList.toggle('open');
}
</script>
</head>

<script>
const presets = {
  beginner: `
# OBIXConfig Lab - Beginner Preset
set throttle_limit_percent = 85
set dshot_bidir = OFF
set iterm_relax = RP
set feedforward_transition = 0
set anti_gravity_gain = 3
save
`,

  freestyle: `
# OBIXConfig Lab - Freestyle Preset
set throttle_limit_percent = 100
set iterm_relax = RPY
set feedforward_transition = 0.5
set anti_gravity_gain = 5
save
`,

  longrange: `
# OBIXConfig Lab - Long Range Preset
set throttle_limit_percent = 80
set iterm_relax = OFF
set feedforward_transition = 0
set anti_gravity_gain = 2
save
`
};

function showPreset(type) {
  document.getElementById("cliOutput").textContent = presets[type];
}

function copyCLI() {
  const text = document.getElementById("cliOutput").textContent;
  navigator.clipboard.writeText(text).then(() => {
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å CLI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß üöÄ");
  });
}
</script>

<body>
<div class="top-bar">
  <div class="top-left">
    <button id="hamburgerBtn" class="hamburger" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π" aria-expanded="false">
      <span class="lines" aria-hidden="true"><span></span><span></span><span></span></span>
    </button>
    <img src="{{ url_for('static', filename='img/obix-logo.png') }}" class="logo" alt="OBIXConfig">
  </div>

  <div style="display:flex;align-items:center;gap:8px;">
    <button class="toggle-theme" onclick="toggleTheme()" title="Toggle theme">üåó</button>
  </div>
</div>

<div class="container">
<!-- overlay + drawer + popover (‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î .container) -->
<div id="overlay" class="overlay" tabindex="-1" aria-hidden="true"></div>

<aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle" hidden>
  <div style="display:flex; align-items:center; justify-content:space-between;">
    <h3 id="drawerTitle" style="margin:0; color:var(--gold,#f1b65a);">‡πÄ‡∏°‡∏ô‡∏π</h3>
    <button id="closeDrawer" aria-label="‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π" style="background:none;border:0;color:inherit;font-size:20px;padding:8px;cursor:pointer;">‚úï</button>
  </div>
<script>
// highlight drawer link ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡∏ñ‡∏∂‡∏á section
const sectionIds = ['quick','keys','cli','pid','check','faq'];
const sections = sectionIds.map(id => document.getElementById(id)).filter(Boolean);
const links = Array.from(document.querySelectorAll('.drawer-link'));

function setActiveForId(id){
  links.forEach(a => {
    const href = a.getAttribute('href') || '';
    if(href.includes('#'+id)) a.classList.add('active');
    else a.classList.remove('active');
  });
}

if('IntersectionObserver' in window){
  const io = new IntersectionObserver(entries => {
    entries.forEach(e => {
      if(e.isIntersecting){
        setActiveForId(e.target.id);
      }
    });
  }, { threshold: 0.45 });

  sections.forEach(s => io.observe(s));
}
</script>
          
  <hr style="opacity:0.06; margin:12px 0;">

  <!-- compact drawer nav ‚Äî ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô (3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) -->
  <nav class="drawer-compact" aria-label="Quick links">
    <a class="drawer-link" href="https://www.facebook.com/banmysanti/" target="_blank" rel="noopener" onclick="closeDrawer()">
      <span class="dl-icon" aria-hidden="true">üìò</span>
      <span class="dl-body">
        <span class="dl-title">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à OBIXConfig Lab</span>
        <span class="dl-meta">‡∏ñ‡∏≤‡∏°-‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå & ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
      </span>
      <span class="dl-pill">open</span>
    </a>

    <a class="drawer-link" href="{{ url_for('about') }}" onclick="closeDrawer();">
      <span class="dl-icon" aria-hidden="true">‚ÑπÔ∏è</span>
      <span class="dl-body">
        <span class="dl-title">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</span>
        <span class="dl-meta">‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ & ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏±‡πâ‡∏ô ‡πÜ</span>
      </span>
      <span class="dl-pill">info</span>
    </a>

    <a class="drawer-link" href="{{ url_for('changelog') }}" onclick="closeDrawer();">
      <span class="dl-icon" aria-hidden="true">üìù</span>
      <span class="dl-body">
        <span class="dl-title">Changelog</span>
        <span class="dl-meta">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</span>
      </span>
      <span class="dl-pill">v1.0b</span>
    </a>
<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏°‡∏ô‡∏π / drawer -->
<a class="drawer-link" href="{{ url_for('downloads_index') }}">
  <div class="menu-card">
    <div class="menu-title">üìÅ ‡πÑ‡∏ü‡∏•‡πå DIFF ‡πÅ‡∏•‡∏∞ DUMP</div>
    <div class="menu-sub">‡∏£‡∏ß‡∏° diff all ‡πÅ‡∏•‡∏∞ dump ‚Äî ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î / ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å CLI</div>
   </div>
</a>
  </nav>

  <div style="margin-top:auto; font-size:12px; opacity:0.85; color:var(--muted,#9aa4b2);">
    OBIXConfig Doctor ‚Ä¢ v1.0b
  </div>
</aside>

<div id="popover" class="popover" aria-hidden="true"></div>
<div class="concept-box">

  <div class="concept-header" onclick="toggleConcept()">
    <span class="concept-title">üß† ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤</span>
<span class="concept-icon">‚ùóüëÜüèª</span>
  </div>

  <div class="concept-content" id="conceptContent">
    <p>
      ‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å <strong>OBIXConfig Doctor</strong><br>
      ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô <strong>‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</strong>
      ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏π‡∏ô‡πÇ‡∏î‡∏£‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏•‡∏≥
    </p>

    <ul>
      <li>üîß ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å <strong>‡∏Ç‡∏ô‡∏≤‡∏î / ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å / ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà / ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</strong></li>
      <li>üìä ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô FPV ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á</li>
      <li>‚ö†Ô∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏™‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏£‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠</li>
    </ul>

    <p class="concept-note">
      ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‚Äì‡∏•‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢<br>
      ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    </p>
  </div>

</div>

<form method="POST" class="form-card">
<!-- ===== Preset selector (OBIXPresets) ===== -->
    <label>Preset (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)</label>
<select id="preset-select" name="preset" class="form-control">
  <option value="">-- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ preset --</option>

  <option value="2.5_micro" {% if request.form.get('preset','')=='2.5_micro' or (analysis and analysis.preset_used=='2.5_micro') %}selected{% endif %}>2.5" ‚Äî Micro</option>
  <option value="3_whoop"   {% if request.form.get('preset','')=='3_whoop'   or (analysis and analysis.preset_used=='3_whoop')   %}selected{% endif %}>3.0" ‚Äî Whoop / Toothpick</option>
  <option value="3.5_cine"  {% if request.form.get('preset','')=='3.5_cine'  or (analysis and analysis.preset_used=='3.5_cine')  %}selected{% endif %}>3.5" ‚Äî Cine</option>
  <option value="4_mini"    {% if request.form.get('preset','')=='4_mini'    or (analysis and analysis.preset_used=='4_mini')    %}selected{% endif %}>4.0" ‚Äî Mini</option>
  <option value="5_freestyle"{% if request.form.get('preset','')=='5_freestyle' or (analysis and analysis.preset_used=='5_freestyle')%}selected{% endif %}>5.0" ‚Äî Freestyle</option>
  <option value="6_heavy5"  {% if request.form.get('preset','')=='6_heavy5'  or (analysis and analysis.preset_used=='6_heavy5')  %}selected{% endif %}>6.0" ‚Äî Heavy</option>
  <option value="7_midlr"   {% if request.form.get('preset','')=='7_midlr'   or (analysis and analysis.preset_used=='7_midlr')   %}selected{% endif %}>7.0" ‚Äî Mid / LR</option>
  <option value="7.5_midlr" {% if request.form.get('preset','')=='7.5_midlr' or (analysis and analysis.preset_used=='7.5_midlr') %}selected{% endif %}>7.5" ‚Äî Mid / LR</option>
  <option value="8_lr"      {% if request.form.get('preset','')=='8_lr'      or (analysis and analysis.preset_used=='8_lr')      %}selected{% endif %}>8.0" ‚Äî Long Range</option>
  <option value="10_lr"     {% if request.form.get('preset','')=='10_lr'     or (analysis and analysis.preset_used=='10_lr')     %}selected{% endif %}>10" ‚Äî Long Range (Big)</option>
</select>
<!-- ===== end preset selector ===== -->
    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏î‡∏£‡∏ô (‡∏ô‡∏¥‡πâ‡∏ß)</label>
    <input type="number" name="size" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5" value="{{ request.form.get('size', '') }}" required>

    <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÇ‡∏î‡∏£‡∏ô (‡∏Å‡∏£‡∏±‡∏°)</label>
    <input type="number" name="weight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 950" value="{{ request.form.get('weight', '') }}" required>

    <label>‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</label>
    <select name="battery">
  <option value="4S" {% if request.form.get('battery','')=='4S' %}selected{% endif %}>4S</option>
  <option value="6S" {% if request.form.get('battery','')=='6S' %}selected{% endif %}>6S</option>
</select>

<label>Battery capacity (mAh) ‚Äî (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
<input type="number" name="battery_mAh" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1500" value="{{ request.form.get('battery_mAh','') }}">

    <label>‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</label>
    <select name="style">
  <option value="freestyle" {% if request.form.get('style','')=='freestyle' %}selected{% endif %}>Freestyle</option>
  <option value="longrange" {% if request.form.get('style','')=='longrange' %}selected{% endif %}>Long Range / Cinematic</option>
  <option value="racing" {% if request.form.get('style','')=='racing' %}selected{% endif %}>Racing</option>
</select>

    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ö‡∏û‡∏±‡∏î (‡∏ô‡∏¥‡πâ‡∏ß)</label>
    <input type="number" name="prop_size" value="{{ request.form.get('prop_size', '5') }}" required>

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö‡∏û‡∏±‡∏î</label>
    <select name="blades">
  <option value="2" {% if request.form.get('blades','')=='2' %}selected{% endif %}>2 ‡πÉ‡∏ö</option>
  <option value="3" {% if request.form.get('blades','')=='3' %}selected{% endif %}>3 ‡πÉ‡∏ö</option>
  <option value="4" {% if request.form.get('blades','')=='4' %}selected{% endif %}>4 ‡πÉ‡∏ö</option>
</select>

    <label>Pitch ‡πÉ‡∏ö‡∏û‡∏±‡∏î</label>
    <input type="number" step="0.1" name="pitch" value="{{ request.form.get('pitch', '4.0') }}" required>

    <button type="submit">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
</form>

{% if analysis %}
<section class="quick-summary">
  <div class="qs-header">
    üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Quick Summary)
  </div>

{% if analysis and analysis.rules %}
<div class="result-card" style="margin-top:10px;">
  <h3>üõ†Ô∏è Smart Checks</h3>
  <div>
    {% for r in analysis.rules %}
      {% if r.level == 'danger' %}
        <div class="alert danger">‚ùå {{ r.msg }}<br><small>{{ r.suggestion }}</small></div>
      {% elif r.level == 'warning' %}
        <div class="alert warning">‚ö†Ô∏è {{ r.msg }}<br><small>{{ r.suggestion }}</small></div>
      {% else %}
        <div class="alert info">‚ÑπÔ∏è {{ r.msg }}{% if r.suggestion %}<br><small>{{ r.suggestion }}</small>{% endif %}</div>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endif %}

{# ---------------- Advanced Analysis Card ---------------- #}
{% if analysis and analysis.advanced %}
<div class="result-card" style="border-left:4px solid var(--accent); margin-top:12px;">
  <h3>üî¨ Advanced Analysis</h3>

  <div class="result-grid">
    <div class="card-metric">
      <div class="metric-label">Pack</div>
      <div class="metric-value">{{ analysis.advanced.cells }}S ‚Ä¢ {{ analysis.advanced.pack_voltage_nominal }} V</div>
      <div class="muted small">{{ analysis.advanced.battery_mAh_used }} mAh ‚Ä¢ {{ analysis.advanced.battery_wh }} Wh</div>
    </div>

    <div class="card-metric">
      <div class="metric-label">Estimated flight time</div>
      <div class="metric-value">{{ analysis.advanced.est_flight_time_min }} min</div>
      <div class="muted small">Aggressive: {{ analysis.advanced.est_flight_time_min_aggr }} min</div>
    </div>

    <div class="card-metric">
      <div class="metric-label">Power / Current</div>
      <div class="metric-value">{{ analysis.advanced.avg_power_w }} W ‚Ä¢ {{ analysis.advanced.current_draw_a }} A</div>
      <div class="muted small">Peak: {{ analysis.advanced.peak_current_a }} A ‚Ä¢ Req C: {{ analysis.advanced.c_required }}C</div>
    </div>

    <div class="card-metric">
      <div class="metric-label">TWR / Hover</div>
      <div class="metric-value">{{ analysis.advanced.thrust_ratio }}</div>
      <div class="muted small">Hover: {{ analysis.advanced.hover_throttle_percent }}% ‚Äî {{ analysis.advanced.efficiency_class }}</div>
    </div>
  </div>

  <hr style="opacity:.06;margin:12px 0;">

  <div style="display:flex;gap:12px;flex-wrap:wrap;">
    <div style="flex:1;min-width:220px;">
      <h4 style="margin:0 0 6px 0;">Motor / Battery Health</h4>
      <p class="muted small">Motor: <strong>{{ analysis.advanced.motor_health }}</strong></p>
      <p class="muted small">Battery: <strong>{{ analysis.advanced.battery_health }}</strong></p>
    </div>

    <div style="flex:1;min-width:260px;">
      <h4 style="margin:0 0 6px 0;">KV suggestion</h4>
      <p>{{ analysis.advanced.kv_suggestion }}</p>
    </div>

    <div style="flex:1;min-width:260px;">
      <h4 style="margin:0 0 6px 0;">Recommendations</h4>
      <ul>
        {% for r in analysis.advanced.recommendations %}
          <li>{{ r }}</li>
        {% else %}
          <li class="muted small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  {% if analysis.advanced.warnings_advanced %}
  <div class="warning-box" style="margin-top:12px;">
    {% for w in analysis.advanced.warnings_advanced %}
      <div class="alert {{ 'danger' if w.level=='danger' else 'warning' if w.level=='warning' else 'info' }}">
        {{ w.msg }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
    <button class="btn-small" onclick="copyAdvancedSummary()">üìã Copy summary</button>
    <a class="btn-small" href="#" onclick="downloadAdvancedJSON()">üìÇ Download JSON</a>
  </div>

  <pre id="advancedSummary" style="display:none;">
{{ analysis.advanced | tojson(indent=2) }}
  </pre>

</div>

<script>
function copyAdvancedSummary(){
  const t = document.getElementById('advancedSummary').innerText;
  navigator.clipboard.writeText(t).then(()=> alert('Copied advanced summary'));
}

function downloadAdvancedJSON(){
  const data = document.getElementById('advancedSummary').innerText;
  const blob = new Blob([data], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'advanced_report.json';
  a.click();
  URL.revokeObjectURL(url);
}
</script>
{% endif %}

  <div class="qs-grid">
    <div class="qs-item">
      <span class="qs-label">‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</span>
      <span class="qs-value">{{ analysis.style }}</span>
    </div>

    <div class="qs-item">
      <span class="qs-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</span>
      <span class="qs-value">{{ analysis.weight_class }}</span>
    </div>

    <div class="qs-item">
      <span class="qs-label">‡πÅ‡∏£‡∏á‡∏Ç‡∏±‡∏ö‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°</span>
      <span class="qs-value">{{ analysis.thrust_ratio }}</span>
    </div>

    <div class="qs-item">
      <span class="qs-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</span>
     <span class="qs-value">{{ analysis.battery_est }} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
    </div>
  </div>

  <div class="qs-advice">
    üí° <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏±‡πâ‡∏ô ‡πÜ:</strong><br>
    {{ analysis.summary }}
  </div>

  <div class="qs-warning">
    ‚ö†Ô∏è ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‚Äì‡∏•‡∏î
  </div>
</section>
<!-- ===== OBIX Detected Class & Baseline (Optional but Recommended) ===== -->
{% if analysis and analysis.advanced %}
<div class="result-card" style="border-left:4px solid var(--accent); margin-top:12px;">
  <h3>üî¨ Advanced Analysis</h3>

  <div class="result-grid">
    <div class="card-metric">
      <div class="metric-label">Estimated hover power</div>
      <div class="metric-value">{{ analysis.advanced.power.est_hover_power_w | default('‚Äî') }} W</div>
      <div class="muted small">Aggressive: {{ analysis.advanced.power.est_aggressive_power_w | default('‚Äî') }} W</div>
    </div>

    <div class="card-metric">
      <div class="metric-label">Battery used for estimate</div>
      <div class="metric-value">{{ analysis.advanced.power.battery_mAh_used | default('‚Äî') }} mAh ‚Ä¢ {{ analysis.advanced.power.cells | default('‚Äî') }}S</div>
      <div class="muted small">Energy: {{ analysis.advanced.power.battery_wh | default('‚Äî') }} Wh</div>
    </div>

    <div class="card-metric">
      <div class="metric-label">Estimated flight time</div>
      <div class="metric-value">{{ analysis.advanced.power.est_flight_time_min | default('‚Äî') }} min</div>
      <div class="muted small">Aggressive: {{ analysis.advanced.power.est_flight_time_min_aggressive | default('‚Äî') }} min</div>
    </div>
  </div>

  <hr style="opacity:.06;margin:12px 0;">

  <div style="display:flex; gap:12px; flex-wrap:wrap;">
    <div style="flex:1; min-width:220px;">
      <h4 style="margin:0 0 6px 0;">TWR / Thrust</h4>
      <p class="muted small">Thrust-to-Weight: <strong>{{ analysis.advanced.thrust_ratio | default('‚Äî') }}</strong></p>
      <p>{{ analysis.advanced.twr_note | default('') }}</p>
    </div>

    <div style="flex:1; min-width:220px;">
      <h4 style="margin:0 0 6px 0;">Motor KV suggestion</h4>
      <p>{{ analysis.advanced.kv_suggestion | default('‚Äî') }}</p>
    </div>

    <div style="flex:1; min-width:220px;">
      <h4 style="margin:0 0 6px 0;">Prop notes</h4>
      <ul>
        {% for n in analysis.advanced.prop_notes %}
          <li>{{ n }}</li>
        {% else %}
          <li class="muted small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  {% if analysis.advanced.warnings_advanced %}
  <div class="warning-box" style="margin-top:12px;">
    {% for w in analysis.advanced.warnings_advanced %}
      <div class="alert warning">{{ w }}</div>
    {% endfor %}
  </div>
  {% endif %}

  <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
    <button class="btn-small" onclick="copyAdvancedSummary()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ</button>
    <a class="btn-small" href="{{ url_for('downloads_index') }}">üìÇ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î diff / files</a>
  </div>

  <pre id="advancedSummary" style="display:none;">
Advanced report
TWR: {{ analysis.advanced.thrust_ratio }}
Hover power: {{ analysis.advanced.power.est_hover_power_w }} W
Est flight time: {{ analysis.advanced.power.est_flight_time_min }} min
KV suggestion: {{ analysis.advanced.kv_suggestion }}
  </pre>

</div>

<script>
function copyAdvancedSummary(){
  const t = document.getElementById('advancedSummary').innerText;
  navigator.clipboard.writeText(t).then(()=> alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ Advanced ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'));
}
</script>
{% endif %}
{% if analysis.detected_class %}
<div class="result-card" style="border-left:4px solid #4CAF50;">
  <h3>üîé OBIX ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô</h3>

  <p>
    <strong>Drone Class:</strong>
    {{ analysis.detected_class }}
    {% if analysis.class_meta.description %}
      ‚Äî {{ analysis.class_meta.description }}
    {% endif %}
  </p>

  <hr>

  <h4>üéØ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Baseline) ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h4>

  <p><strong>PID Baseline</strong></p>
  <pre>
ROLL  P {{ analysis.pid_baseline.roll.p }}  I {{ analysis.pid_baseline.roll.i }}  D {{ analysis.pid_baseline.roll.d }}
PITCH P {{ analysis.pid_baseline.pitch.p }} I {{ analysis.pid_baseline.pitch.i }} D {{ analysis.pid_baseline.pitch.d }}
YAW   P {{ analysis.pid_baseline.yaw.p }}   I {{ analysis.pid_baseline.yaw.i }}
  </pre>

  <p><strong>Filter Baseline</strong></p>
  <pre>
Gyro LPF2: {{ analysis.filter_baseline.gyro_lpf2 }} Hz
D-Term LPF1: {{ analysis.filter_baseline.dterm_lpf1 }} Hz
Dynamic Notch: {{ analysis.filter_baseline.dyn_notch }}
  </pre>

  <p style="font-size:0.9em; opacity:0.85;">
    ‚ö†Ô∏è ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ <strong>‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</strong><br>
    ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß
  </p>
</div>
{% endif %}
<!-- ===== END OBIX Detected Class ===== -->
<div class="result-card">
<h2>üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>

{% if analysis and analysis.warnings %}
<div class="warning-box">
  {% for w in analysis.warnings %}
    <div class="alert {{ w.level }}">
      {% if w.level == "danger" %}‚ùå{% endif %}
      {% if w.level == "warning" %}‚ö†Ô∏è{% endif %}
      {% if w.level == "info" %}‚ÑπÔ∏è{% endif %}
      {{ w.msg }}
    </div>
  {% endfor %}
</div>
{% endif %}

<p><strong>{{ analysis.overview }}</strong></p>

<div class="preset-box">
  <h3>üéõ Preset ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å OBIXConfig Lab</h3>

  <!-- ===== Preset Grid (‡∏ß‡∏≤‡∏á‡πÅ‡∏ó‡∏ô preset-grid ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ===== -->
<div class="preset-grid">

  <!-- Beginner / Smooth -->
  <article class="preset-item preset-beginner" role="article" aria-label="Beginner Preset">
    <div style="display:flex; align-items:center; gap:12px;">
      <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#e8fff0,#c6f2dd);display:grid;place-items:center;font-weight:800;color:#024;">
        B
      </div>
      <div style="flex:1;">
        <h4 style="margin:0 0 4px 0;">Beginner / Smooth</h4>
        <div class="muted small">‡∏ö‡∏¥‡∏ô‡∏ô‡∏¥‡πà‡∏á ‡∏Ñ‡∏∏‡∏°‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</div>
      </div>
    </div>

    <ul style="margin:12px 0 0 18px;">
      <li>Throttle limit: <strong>85%</strong></li>
      <li>Rates: ‡∏ï‡πà‡∏≥‚Äì‡∏Å‡∏•‡∏≤‡∏á</li>
      <li>Filter: ‡πÄ‡∏ô‡πâ‡∏ô‡∏ô‡∏∏‡πà‡∏°</li>
    </ul>

    <div style="display:flex; gap:8px; margin-top:12px; align-items:center;">
      <button class="btn-primary" onclick="showPreset('beginner')">‡πÅ‡∏™‡∏î‡∏á CLI</button>
      <button class="btn-ghost" onclick="document.getElementById('cliOutput').scrollIntoView({behavior:'smooth'})">‡πÑ‡∏õ‡∏ó‡∏µ‡πà CLI</button>
      <a class="btn-ghost" href="/downloads?filter=beginner" title="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå" style="margin-left:auto;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå</a>
    </div>
  </article>

  <!-- Freestyle -->
  <article class="preset-item preset-freestyle" role="article" aria-label="Freestyle Preset">
    <div style="display:flex; align-items:center; gap:12px;">
      <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#dceeff,#b7dbff);display:grid;place-items:center;font-weight:800;color:#023;">
        F
      </div>
      <div style="flex:1;">
        <h4 style="margin:0 0 4px 0;">Freestyle</h4>
        <div class="muted small">‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡πÑ‡∏ß ‡∏Ñ‡∏∏‡∏°‡πÅ‡∏°‡πà‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏µ‡∏ó‡πà‡∏≤</div>
      </div>
    </div>

    <ul style="margin:12px 0 0 18px;">
      <li>Throttle limit: <strong>90‚Äì100%</strong></li>
      <li>Rates: ‡∏Å‡∏•‡∏≤‡∏á‚Äì‡∏™‡∏π‡∏á</li>
      <li>Filter: ‡∏™‡∏°‡∏î‡∏∏‡∏• ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ô‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ö‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á</li>
    </ul>

    <div style="display:flex; gap:8px; margin-top:12px; align-items:center;">
      <button class="btn-primary" onclick="showPreset('freestyle')">‡πÅ‡∏™‡∏î‡∏á CLI</button>
      <button class="btn-ghost" onclick="copyCLI()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å CLI</button>
      <a class="btn-ghost" href="/downloads?filter=freestyle" style="margin-left:auto;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå</a>
    </div>
  </article>

  <!-- Long-Range / Cinematic -->
  <article class="preset-item preset-longrange" role="article" aria-label="Long Range Preset">
    <div style="display:flex; align-items:center; gap:12px;">
      <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#f1d9ff,#e6c8ff);display:grid;place-items:center;font-weight:800;color:#2a0a4b;">
        L
      </div>
      <div style="flex:1;">
        <h4 style="margin:0 0 4px 0;">Long-Range / Cinematic</h4>
        <div class="muted small">‡∏ô‡∏¥‡πà‡∏á ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü ‡∏•‡∏≠‡∏¢‡∏ô‡∏≤‡∏ô</div>
      </div>
    </div>

    <ul style="margin:12px 0 0 18px;">
      <li>Throttle limit: <strong>80‚Äì85%</strong></li>
      <li>Rates: ‡∏ï‡πà‡∏≥</li>
      <li>Filter: ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î</li>
    </ul>

    <div style="display:flex; gap:8px; margin-top:12px; align-items:center;">
      <button class="btn-primary" onclick="showPreset('longrange')">‡πÅ‡∏™‡∏î‡∏á CLI</button>
      <button class="btn-ghost" onclick="copyCLI()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å CLI</button>
      <a class="btn-ghost" href="/downloads?filter=longrange" style="margin-left:auto;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå</a>
    </div>
  </article>

</div>
<!-- ===== END Preset Grid ===== -->

  <p class="preset-note">
    * Preset ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
 <div class="cli-box">
  <h3>üß† CLI Preset (Betaflight)</h3>

  <pre id="cliOutput">
# ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Preset ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á CLI
  </pre>

  <button onclick="copyCLI()" class="copy-btn">
    üìã Copy CLI
  </button>
</div>
 </p>
</div>
<h3>‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
<ul>
{% for tip in analysis.basic_tips %}
<li>{{ tip }}</li>
{% endfor %}
</ul>

<h3>‚öôÔ∏è PID (‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</h3>
<pre id="pid">
ROLL  P {{ analysis.pid.roll.p }}  I {{ analysis.pid.roll.i }}  D {{ analysis.pid.roll.d }}
PITCH P {{ analysis.pid.pitch.p }} I {{ analysis.pid.pitch.i }} D {{ analysis.pid.pitch.d }}
YAW   P {{ analysis.pid.yaw.p }}   I {{ analysis.pid.yaw.i }}
</pre>
<button onclick="copyText('pid')">Copy PID</button>

<h3>üß† Filter</h3>
<pre id="filter">
Gyro LPF2: {{ analysis.filter.gyro_lpf2 }} Hz
D-Term LPF1: {{ analysis.filter.dterm_lpf1 }} Hz
Dynamic Notch: {{ analysis.filter.dyn_notch }}
</pre>
<button onclick="copyText('filter')">Copy Filter</button>

<h3>üõ©Ô∏è ‡πÉ‡∏ö‡∏û‡∏±‡∏î</h3>
<p>{{ analysis.prop_result.summary }}</p>
<ul>
<li>Noise: {{ analysis.prop_result.effect.noise }}</li>
<li>Motor Load: {{ analysis.prop_result.effect.motor_load }}</li>
<li>Grip: {{ analysis.prop_result.effect.grip }}</li>
<li>Recommendation: {{ analysis.prop_result.recommendation }}</li>
</ul>

<h3>üí° Extra Tools</h3>
<p>Thrust-to-Weight Ratio: {{ analysis.thrust_ratio }}</p>
<p style="font-size:1.2em; font-weight:bold; color:#4CAF50;">
‚è± ‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: {{ analysis.battery_est }} ‡∏ô‡∏≤‡∏ó‡∏µ
</p>

<h3>üìä Visualization</h3>
<canvas id="thrustChart" width="400" height="200"></canvas>
<canvas id="noiseChart" width="400" height="200"></canvas>

<script>
const thrustCtx = document.getElementById('thrustChart').getContext('2d');
new Chart(thrustCtx, {
    type: 'bar',
    data: {
        labels: ['Thrust-to-Weight'],
        datasets: [{
            label: 'Ratio',
            data: [{{ analysis.thrust_ratio }}],
            backgroundColor: ['rgba(54, 162, 235, 0.6)']
        }]
    },
    options: { scales: { y: { beginAtZero: true } } }
});

const noiseCtx = document.getElementById('noiseChart').getContext('2d');
new Chart(noiseCtx, {
    type: 'line',
    data: {
        labels: ['Motor Load', 'Noise Level'],
        datasets: [{
            label: 'Effect',
            data: [{{ analysis.prop_result.effect.motor_load }}, {{ analysis.prop_result.effect.noise }}],
            fill: false,
            borderColor: 'rgb(255, 99, 132)',
            tension: 0.3
        }]
    },
    options: { scales: { y: { beginAtZero: true } } }
});
</script>

</div>
{% endif %}

<div class="community-box">
  <p class="community-text">
    ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ <strong>OBIXCONFIG DOCTOR</strong> ‡∏¢‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ üöß<br><br>

    ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå<br>
 ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏´‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏≠‡∏∞‡πÑ‡∏£<br>

    <span class="highlight">
      ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à<br>
      <strong>OBIXConfig Lab</strong>
    </span><br><br>

    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß FPV üáπüá≠ ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏£‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô 
  </p>

  <a href="https://www.facebook.com/banmysanti/"
     target="_blank"
     class="community-btn">
     ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à OBIXConfig Lab
  </a>
</div>

<div class="version-note">
  OBIXConfig Doctor ‚Ä¢ v1.0b (Community Build)<br>
  Developed by real FPV pilots üáπüá≠
</div>

</div>
<script>
  // Drawer open/close
  const btn = document.getElementById('hamburgerBtn');
  const drawer = document.getElementById('drawer');
  const overlay = document.getElementById('overlay');
  const closeDrawerBtn = document.getElementById('closeDrawer');

  function openDrawer(){
    if(!btn) return;
    btn.setAttribute('aria-expanded','true');
    overlay.classList.add('open');
    drawer.classList.add('open');
    drawer.removeAttribute('hidden');
    overlay.setAttribute('aria-hidden','false');
    document.addEventListener('keydown', escClose);
  }
  function closeDrawer(){
    if(!btn) return;
    btn.setAttribute('aria-expanded','false');
    overlay.classList.remove('open');
    drawer.classList.remove('open');
    overlay.setAttribute('aria-hidden','true');
    document.removeEventListener('keydown', escClose);
    setTimeout(()=> drawer.setAttribute('hidden',''), 240);
    btn.focus();
  }
  function escClose(e){ if(e.key === 'Escape') closeDrawer(); }

  if(btn) btn.addEventListener('click', ()=> {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    if(expanded) closeDrawer(); else openDrawer();
  });
  if(overlay) overlay.addEventListener('click', closeDrawer);
  if(closeDrawerBtn) closeDrawerBtn.addEventListener('click', closeDrawer);

  // Accordion
  document.querySelectorAll('.accordion-item').forEach(item=>{
    const head = item.querySelector('.accordion-head');
    head.addEventListener('click', ()=> {
      const open = item.classList.toggle('open');
      head.querySelector('span').textContent = open ? '‚àí' : '+';
    });
  });

  // Popover help (optional: hook to info icons next to inputs)
  const pop = document.getElementById('popover');
  const helpTexts = {
    preset: 'Preset = ‡∏ä‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° PID/Rates/Filters ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô',
    size: '‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏î‡∏£‡∏ô (‡∏ô‡∏¥‡πâ‡∏ß) ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ü‡∏£‡∏° ‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ô‡∏¥‡πâ‡∏ß',
    weight: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°‡∏ï‡∏≠‡∏ô‡∏ö‡∏¥‡∏ô (‡∏Å‡∏£‡∏±‡∏°) ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏¥‡∏ô',
    battery: '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô 4S ‡∏´‡∏£‡∏∑‡∏≠ 6S ‚Äî ‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÅ‡∏•‡∏∞ RPM ‡∏Ç‡∏≠‡∏á‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå',
    style: '‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô: Freestyle / Racing / Long-range ‚Äî ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö Rates ‡πÅ‡∏•‡∏∞ PID',
    prop: '‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ö‡∏û‡∏±‡∏î (‡∏ô‡∏¥‡πâ‡∏ß) ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏¢‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü'
  };

  // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏° info ‡∏Ç‡πâ‡∏≤‡∏á input ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° <button class="info-btn" data-pop="size">i</button> ‡∏Ç‡πâ‡∏≤‡∏á input ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  function openPopover(key, targetBtn){
    pop.textContent = helpTexts[key] || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢';
    pop.classList.add('open');
    pop.setAttribute('aria-hidden','false');
    const rect = targetBtn.getBoundingClientRect();
    let top = rect.top + window.scrollY + rect.height + 8;
    let left = rect.left + window.scrollX;
    const vw = window.innerWidth;
    if(left + 320 > vw) left = vw - 336;
    pop.style.top = top + 'px';
    pop.style.left = left + 'px';
    targetBtn.setAttribute('aria-expanded','true');
    setTimeout(()=> document.addEventListener('click', outsideClick), 10);
    document.addEventListener('keydown', popEsc);
  }
  function closePopover(){
    pop.classList.remove('open');
    pop.setAttribute('aria-hidden','true');
    document.querySelectorAll('.info-btn').forEach(b=> b.setAttribute('aria-expanded','false'));
    document.removeEventListener('click', outsideClick);
    document.removeEventListener('keydown', popEsc);
  }
  function outsideClick(e){ if(!pop.contains(e.target) && !e.target.classList.contains('info-btn')) closePopover(); }
  function popEsc(e){ if(e.key === 'Escape') closePopover(); }

  document.querySelectorAll('.info-btn[data-pop]').forEach(b => {
    const key = b.getAttribute('data-pop');
    b.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const open = b.getAttribute('aria-expanded') === 'true';
      if(open) { closePopover(); return; }
      openPopover(key, b);
    });
  });

  // Responsive: show drawer always on wide screens (optional)
  window.addEventListener('resize', ()=> {
    if(window.innerWidth > 900){
      drawer.removeAttribute('hidden');
      drawer.classList.remove('open');
      overlay.classList.remove('open');
    } else {
      drawer.setAttribute('hidden','');
    }
  });
  if(window.innerWidth <= 900) drawer.setAttribute('hidden','');
</script>
<!-- OBIX Preset autofill JS -->
<script>
const presetMap = {
  "2.5_micro": {size:2.5, weight:80, battery:"2S", prop_size:2.5, pitch:2.0, blades:"2", style:"micro"},
  "3_whoop":   {size:3.0, weight:120, battery:"2S", prop_size:3.0, pitch:2.0, blades:"2", style:"whoop"},
  "3.5_cine":  {size:3.5, weight:350, battery:"4S", prop_size:3.5, pitch:2.5, blades:"2", style:"cine"},
  "4_mini":    {size:4.0, weight:420, battery:"4S", prop_size:4.0, pitch:3.0, blades:"2", style:"mini"},
  "5_freestyle":{size:5.0, weight:750, battery:"4S", prop_size:5.0, pitch:4.0, blades:"3", style:"freestyle"},
  "6_heavy5":  {size:6.0, weight:1000, battery:"4S", prop_size:6.0, pitch:4.0, blades:"3", style:"heavy"},
  "7_midlr":   {size:7.0, weight:1100, battery:"4S", prop_size:7.0, pitch:3.5, blades:"2", style:"longrange"},
  "7.5_midlr": {size:7.5, weight:1200, battery:"4S", prop_size:7.5, pitch:3.0, blades:"2", style:"longrange"},
  "8_lr":      {size:8.0, weight:1500, battery:"6S", prop_size:8.0, pitch:3.5, blades:"2", style:"longrange"},
  "10_lr":     {size:10.0, weight:2200, battery:"6S", prop_size:10.0, pitch:4.5, blades:"2", style:"longrange"}
};

// helper: set value if element exists
function setIfExists(selector, value) {
  const el = document.querySelector(selector);
  if (!el) return false;
  if (el.tagName === 'SELECT' || el.type === 'select-one') {
    el.value = value;
    el.dispatchEvent(new Event('change', { bubbles: true }));
  } else {
    el.value = value;
  }
  return true;
}

const presetSelect = document.getElementById('preset-select');
if (presetSelect) {
  presetSelect.addEventListener('change', function () {
    const key = this.value;
    if (!key) return;
    const p = presetMap[key];
    if (!p) return;

    // fill fields (matches names in your form)
    setIfExists('input[name="size"]', p.size);
    setIfExists('input[name="weight"]', p.weight);
    setIfExists('select[name="battery"]', p.battery);
    setIfExists('input[name="prop_size"]', p.prop_size);
    setIfExists('input[name="pitch"]', p.pitch);
    setIfExists('select[name="blades"]', p.blades);
    // style may be select or input; try both
    setIfExists('select[name="style"]', p.style);
    setIfExists('input[name="style"]', p.style);
  });
}
</script>
<script>
// drawer simple toggle (if not present)
const ham = document.getElementById('hamburgerBtn');
const drawer = document.querySelector('.drawer');
const overlay = document.querySelector('.overlay');

if(ham){
  ham.addEventListener('click', ()=>{
    const expanded = ham.getAttribute('aria-expanded') === 'true';
    ham.setAttribute('aria-expanded', !expanded);
    if(drawer) drawer.classList.toggle('open');
    if(overlay) overlay.classList.toggle('open');
  });
}

// smooth scroll for anchors
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
  });
});
</script>
<!-- end OBIX Preset autofill JS -->
</body>
</html>
