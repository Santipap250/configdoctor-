<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>OBIXConfig Doctor ‚Äî ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏£‡∏ô FPV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
{% set og_title       = "Drone Analyzer ‚Äî OBIXConfig Doctor" %}
{% set og_description = "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤ PID ¬∑ Filter ¬∑ Motor ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô FPV ‚Äî ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏£‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" %}
{% set og_url         = "https://configdoctor.onrender.com/app" %}
{% include "partials/og_tags.html" %}
<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// ‚îÄ‚îÄ Theme init (‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô paint ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô flash) ‚îÄ‚îÄ
(function(){
  var t = localStorage.getItem('theme') || 'dark';
  document.documentElement.className = t;
  document.addEventListener('DOMContentLoaded', function(){
    document.body.classList.add(t);
  });
})();

function toggleTheme(){
  var isDark = document.body.classList.contains('dark');
  document.body.classList.toggle('dark', !isDark);
  document.body.classList.toggle('light', isDark);
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
}

function copyText(id){
  var el = document.getElementById(id);
  if(!el) return;
  navigator.clipboard.writeText(el.innerText).then(function(){
    showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úì');
  });
}

function showToast(msg){
  var t = document.getElementById('toast');
  if(!t){ t = document.createElement('div'); t.id='toast';
    t.style.cssText='position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#10c47a;color:#021a0e;padding:8px 18px;border-radius:20px;font-weight:700;font-size:.87rem;z-index:999;transition:opacity .3s;';
    document.body.appendChild(t); }
  t.textContent = msg; t.style.opacity = '1';
  clearTimeout(t._t);
  t._t = setTimeout(function(){ t.style.opacity='0'; }, 2000);
}

function toggleConcept(){
  document.querySelector('.concept-box').classList.toggle('open');
}
</script>
</head>

<body>
<!-- ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ -->
<div class="top-bar">
  <div class="top-left">
    <button id="hamburgerBtn" class="hamburger" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π" aria-expanded="false">
      <span class="lines" aria-hidden="true">
        <span></span><span></span><span></span>
      </span>
    </button>
    <a href="/landing">
      <img src="{{ url_for('static', filename='img/obix-logo.png') }}" class="logo" alt="OBIXConfig Doctor">
    </a>
  </div>
  <button class="toggle-theme" onclick="toggleTheme()" title="‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°">üåó</button>
</div>

<!-- ‚îÄ‚îÄ OVERLAY + DRAWER ‚îÄ‚îÄ -->
<div id="overlay" class="overlay" tabindex="-1" aria-hidden="true"></div>

<aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle" hidden>
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
    <span id="drawerTitle" style="font-weight:700;font-size:1rem;color:var(--green);">‡πÄ‡∏°‡∏ô‡∏π</span>
    <button id="closeDrawer" aria-label="‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π" style="background:none;border:0;color:var(--muted);font-size:20px;cursor:pointer;">‚úï</button>
  </div>

  <hr style="margin-bottom:12px;">

  <nav aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å">
    <a class="drawer-link" href="/app">
      <span class="dl-icon">üè†</span>
      <span class="dl-body">
        <span class="dl-title">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å / ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
        <span class="dl-meta">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏£‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•</span>
      </span>
      <span class="dl-pill">main</span>
    </a>

    <a class="drawer-link" href="/motor-prop">
      <span class="dl-icon">üß≠</span>
      <span class="dl-body">
        <span class="dl-title">Motor √ó Prop Recommender</span>
        <span class="dl-meta">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå/‡πÉ‡∏ö‡∏û‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å & ‡πÅ‡∏ö‡∏ï</span>
      </span>
      <span class="dl-pill">tool</span>
    </a>

<a class="drawer-link" href="/cli_surgeon" onclick="closeDrawer();">
  <span class="dl-icon">ü©∫</span>
  <span class="dl-body">
    <span class="dl-title">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå CLI Dump (The CLI Surgeon)</span>
    <span class="dl-meta">‡∏ß‡∏≤‡∏á diff all / dump ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>
  </span>
  <span class="dl-pill">tool</span>
</a>

    <a class="drawer-link" href="/pid-advisor" onclick="closeDrawer();">
  <span class="dl-icon">üíä</span>
  <span class="dl-body">
    <span class="dl-title">PID Symptom Advisor</span>
    <span class="dl-meta">‡∏ö‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‚Üí ‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ PID + CLI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>
  </span>
  <span class="dl-pill">new</span>
</a>

<a class="drawer-link" href="/rpm-filter" onclick="closeDrawer();">
  <span class="dl-icon">‚öôÔ∏è</span>
  <span class="dl-body">
    <span class="dl-title">RPM Filter Calculator</span>
    <span class="dl-meta">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì harmonic frequency + dyn_notch ‡∏à‡∏≤‡∏Å KV & ‡πÅ‡∏ö‡∏ï</span>
  </span>
  <span class="dl-pill">new</span>
</a>

<a class="drawer-link" href="/rates-visualizer" onclick="closeDrawer();">
  <span class="dl-icon">üìà</span>
  <span class="dl-body">
    <span class="dl-title">Rates Visualizer</span>
    <span class="dl-meta">‡∏î‡∏π curve ‡πÅ‡∏ö‡∏ö real-time + ‡∏™‡∏£‡πâ‡∏≤‡∏á CLI command</span>
  </span>
  <span class="dl-pill">new</span>
</a>

<a class="drawer-link" href="/cli-comparator" onclick="closeDrawer();">
  <span class="dl-icon">‚öñÔ∏è</span>
  <span class="dl-body">
    <span class="dl-title">CLI Diff Comparator</span>
    <span class="dl-meta">‡∏ß‡∏≤‡∏á 2 config ‚Üí ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</span>
  </span>
  <span class="dl-pill">new</span>
</a>

<a class="drawer-link" href="/esc-checker" onclick="closeDrawer();">
  <span class="dl-icon">‚ö°</span>
  <span class="dl-body">
    <span class="dl-title">ESC Compatibility Checker</span>
    <span class="dl-meta">‡∏ï‡∏£‡∏ß‡∏à ESC amps, protocol, KV+‡πÅ‡∏ö‡∏ï compatibility</span>
  </span>
  <span class="dl-pill">new</span>
</a>

    <a class="drawer-link" href="/vtx">
      <span class="dl-icon">üì°</span>
      <span class="dl-body">
        <span class="dl-title">VTX Bands & Channels</span>
        <span class="dl-meta">‡∏™‡∏π‡∏ï‡∏£ band/channel + ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span>
      </span>
      <span class="dl-pill">tool</span>
    </a>

    <a class="drawer-link" href="/vtx-range">
      <span class="dl-icon">üì°üèûÔ∏è</span>
      <span class="dl-body">
        <span class="dl-title">VTX Range Calculator</span>
        <span class="dl-meta">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì + ‡∏Å‡∏£‡∏≤‡∏ü</span>
      </span>
      <span class="dl-pill">tool</span>
    </a>

    <a class="drawer-link" href="/downloads">
      <span class="dl-icon">üìÅ</span>
      <span class="dl-body">
        <span class="dl-title">‡πÑ‡∏ü‡∏•‡πå DIFF ‡πÅ‡∏•‡∏∞ DUMP</span>
        <span class="dl-meta">‡∏£‡∏ß‡∏° diff all / dump CLI ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ</span>
      </span>
      <span class="dl-pill">files</span>
    </a>

    <a class="drawer-link" href="https://www.facebook.com/banmysanti/" target="_blank" rel="noopener">
      <span class="dl-icon">üìò</span>
      <span class="dl-body">
        <span class="dl-title">‡πÄ‡∏û‡∏à OBIXConfig Lab</span>
        <span class="dl-meta">‡∏ñ‡∏≤‡∏°-‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå & ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
      </span>
      <span class="dl-pill">open</span>
    </a>

    <a class="drawer-link" href="{{ url_for('about') }}">
      <span class="dl-icon">‚ÑπÔ∏è</span>
      <span class="dl-body">
        <span class="dl-title">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</span>
        <span class="dl-meta">‡∏ó‡∏µ‡πà‡∏°‡∏≤ & ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
      </span>
      <span class="dl-pill">info</span>
    </a>

    <a class="drawer-link" href="{{ url_for('changelog') }}">
      <span class="dl-icon">üìù</span>
      <span class="dl-body">
        <span class="dl-title">Changelog</span>
        <span class="dl-meta">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</span>
      </span>
      <span class="dl-pill">v1.0.1b</span>
    </a>
  </nav>
</aside>

<!-- ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ -->
<div class="container">

<!-- ‚îÄ‚îÄ CONCEPT BOX ‚îÄ‚îÄ -->
<div class="concept-box" style="margin-top:20px;">
  <div class="concept-header" onclick="toggleConcept()">
    <span class="concept-title">üß† ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤</span>
    <span class="concept-icon">‚ñæ</span>
  </div>
  <div class="concept-content">
    <p>
      ‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å <strong>OBIXConfig Doctor</strong>
      ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô <strong>‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</strong>
    </p>
    <ul>
      <li>üîß ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å <strong>‡∏Ç‡∏ô‡∏≤‡∏î / ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å / ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà / ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</strong></li>
      <li>üìä ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô FPV ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á</li>
      <li>‚ö†Ô∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏™‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏£‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠</li>
    </ul>
    <p class="concept-note">
      ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‚Äì‡∏•‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏î‡∏£‡∏ô
    </p>
  </div>
</div>

<!-- ‚îÄ‚îÄ FORM ‚îÄ‚îÄ -->
<div class="form-card">
  <h2 style="font-size:1rem;color:var(--green);margin-bottom:18px;">
    ‚öôÔ∏è ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏£‡∏ô
  </h2>

  <form method="POST">
    <!-- Preset -->
    <label>Preset (‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)</label>
    <select id="preset-select" name="preset">
      <option value="">-- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ preset --</option>
      {% for key, label in [
        ('2.5_micro','2.5\" ‚Äî Micro'),
        ('3_whoop','3.0\" ‚Äî Whoop / Toothpick'),
        ('3.5_cine','3.5\" ‚Äî Cine'),
        ('4_mini','4.0\" ‚Äî Mini'),
        ('5_freestyle','5.0\" ‚Äî Freestyle'),
        ('6_heavy5','6.0\" ‚Äî Heavy'),
        ('7_midlr','7.0\" ‚Äî Mid / LR'),
        ('7.5_midlr','7.5\" ‚Äî Mid / LR'),
        ('8_lr','8.0\" ‚Äî Long Range'),
        ('10_lr','10\" ‚Äî Long Range (Big)')
      ] %}
      <option value="{{ key }}"
        {% if request.form.get('preset','')==key or (analysis and analysis.preset_used==key) %}selected{% endif %}>
        {{ label }}
      </option>
      {% endfor %}
    </select>

    <div class="form-grid">
      <div>
        <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏î‡∏£‡∏ô (‡∏ô‡∏¥‡πâ‡∏ß)</label>
        <input type="number" step="0.1" name="size" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5" value="{{ request.form.get('size','') }}" required>
      </div>
      <div>
        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÇ‡∏î‡∏£‡∏ô (‡∏Å‡∏£‡∏±‡∏°)</label>
        <input type="number" name="weight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 750" value="{{ request.form.get('weight','') }}" required>
      </div>
    </div>

    <div class="form-grid">
      <div>
        <label>‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</label>
        <select name="battery" id="battery-select">
          {% for c in ['3S','4S','5S','6S','7S','8S'] %}
          <option value="{{ c }}" {% if request.form.get('battery','')==c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>Battery capacity (mAh)</label>
        <input type="number" name="battery_mAh" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1500" value="{{ request.form.get('battery_mAh','') }}">
      </div>
    </div>

    <div class="form-grid">
      <div>
        <label>‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</label>
        <select name="style">
          <option value="freestyle" {% if request.form.get('style','')=='freestyle' %}selected{% endif %}>Freestyle</option>
          <option value="longrange" {% if request.form.get('style','')=='longrange' %}selected{% endif %}>Long Range / Cinematic</option>
          <option value="racing"    {% if request.form.get('style','')=='racing'    %}selected{% endif %}>Racing</option>
        </select>
      </div>
      <div>
        <label>Motor Count</label>
        <input type="number" name="motor_count" value="{{ request.form.get('motor_count','4') }}" min="1" max="8">
      </div>
    </div>

    <div class="form-grid">
      <div>
        <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ö‡∏û‡∏±‡∏î (‡∏ô‡∏¥‡πâ‡∏ß)</label>
        <input type="number" step="0.1" name="prop_size" value="{{ request.form.get('prop_size','5') }}" required>
      </div>
      <div>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö‡∏û‡∏±‡∏î</label>
        <select name="blades">
          {% for n in [2,3,4] %}
          <option value="{{ n }}" {% if request.form.get('blades','')==(n|string) %}selected{% endif %}>{{ n }} ‡πÉ‡∏ö</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-grid">
      <div>
        <label>Pitch ‡πÉ‡∏ö‡∏û‡∏±‡∏î</label>
        <input type="number" step="0.1" name="pitch" value="{{ request.form.get('pitch','4.0') }}" required>
      </div>
      <div>
        <label>Motor KV (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input type="number" name="motor_kv" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2306" value="{{ request.form.get('motor_kv','') }}">
      </div>
    </div>

    <button type="submit">üöÅ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏£‡∏ô</button>
  </form>
</div>

<!-- ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ -->
{% if analysis %}

<!-- Quick Summary -->
<section class="quick-summary">
  <div class="qs-header">üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</div>
  <div class="qs-grid">
    <div class="qs-item">
      <span class="qs-label">‡∏™‡πÑ‡∏ï‡∏•‡πå</span>
      <span class="qs-value">{{ analysis.style | capitalize }}</span>
    </div>
    <div class="qs-item">
      <span class="qs-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</span>
      <span class="qs-value">{{ analysis.weight_class }}</span>
    </div>
    <div class="qs-item">
      <span class="qs-label">TWR</span>
      <span class="qs-value" style="color:
        {% if analysis.thrust_ratio and analysis.thrust_ratio < 1.2 %}var(--red)
        {% elif analysis.thrust_ratio and analysis.thrust_ratio > 3 %}var(--gold)
        {% else %}var(--green){% endif %}">
        {% if analysis.thrust_ratio %}{{ analysis.thrust_ratio }}{% else %}‚Äî{% endif %}
      </span>
    </div>
    <div class="qs-item">
      <span class="qs-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏¥‡∏ô</span>
      <span class="qs-value">
        {% if analysis.est_flight_time_min %}{{ analysis.est_flight_time_min }} min
        {% elif analysis.battery_est %}{{ analysis.battery_est }} min
        {% else %}‚Äî{% endif %}
      </span>
    </div>
  </div>
  <div class="qs-advice">üí° {{ analysis.summary }}</div>
  <div class="qs-warning" style="margin-top:8px;">
    ‚ö†Ô∏è ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏±‡∏ö
  </div>
</section>

<!-- Warnings -->
{% if analysis.warnings %}
<div class="result-card" style="padding-bottom:14px;">
  <h3 style="margin-top:0;">üö® ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h3>
  <div class="warning-box">
    {% for w in analysis.warnings %}
    <div class="alert {{ w.level }}">
      {% if w.level == 'danger' %}‚ùå{% elif w.level == 'warning' %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
      {{ w.msg }}
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Smart Checks -->
{% if analysis.rules %}
<div class="result-card">
  <h3 style="margin-top:0;color:var(--gold);">üõ†Ô∏è Smart Checks</h3>
  <div class="warning-box">
    {% for r in analysis.rules %}
    <div class="alert {{ r.level }}">
      {% if r.level=='danger' %}‚ùå{% elif r.level=='warning' %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
      <strong>{{ r.msg }}</strong>
      {% if r.suggestion %}<small>{{ r.suggestion }}</small>{% endif %}
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Advanced Analysis (ONE card, ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥) -->
{% if analysis.advanced %}
<div class="result-card" style="border-left:3px solid var(--green);">
  <h3 style="margin-top:0;color:var(--green);">üî¨ Advanced Analysis</h3>

  <!-- Tab Navigation -->
  <div class="result-tabs">
    <button class="tab-btn active" onclick="switchTab(this,'tab-power')">‚ö° Power</button>
    <button class="tab-btn" onclick="switchTab(this,'tab-health')">ü©∫ Health</button>
    <button class="tab-btn" onclick="switchTab(this,'tab-kv')">üîß Motor / KV</button>
  </div>

  <!-- Tab: Power -->
  <div id="tab-power" class="tab-pane active">
    <div class="result-grid">
      <div class="card-metric">
        <div class="metric-label">Pack</div>
        <div class="metric-value">{{ analysis.advanced.cells }}S ‚Äî {{ analysis.advanced.pack_voltage_nominal }} V</div>
        <div class="muted small">{{ analysis.advanced.battery_mAh_used }} mAh ‚Ä¢ {{ analysis.advanced.battery_wh }} Wh</div>
      </div>
      <div class="card-metric">
        <div class="metric-label">Estimated Flight Time</div>
        <div class="metric-value" style="color:var(--green);">
          {{ analysis.advanced.est_flight_time_min }} min
        </div>
        <div class="muted small">Aggressive: {{ analysis.advanced.est_flight_time_min_aggr }} min</div>
      </div>
      <div class="card-metric">
        <div class="metric-label">Power / Current</div>
        <div class="metric-value">{{ analysis.advanced.avg_power_w }} W</div>
        <div class="muted small">{{ analysis.advanced.current_draw_a }} A hover ‚Ä¢ Peak {{ analysis.advanced.peak_current_a }} A</div>
      </div>
      <div class="card-metric">
        <div class="metric-label">Required C-Rating</div>
        <div class="metric-value" style="color:
          {% if analysis.advanced.c_required and analysis.advanced.c_required > 60 %}var(--red)
          {% elif analysis.advanced.c_required and analysis.advanced.c_required > 40 %}var(--gold)
          {% else %}var(--green){% endif %}">
          {% if analysis.advanced.c_required %}{{ analysis.advanced.c_required }}C{% else %}‚Äî{% endif %}
        </div>
        <div class="muted small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ï‡∏ó‡∏µ‡πà rating ‚â• ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ</div>
      </div>
    </div>
  </div>

  <!-- Tab: Health -->
  <div id="tab-health" class="tab-pane">
    <div class="result-grid">
      <div class="card-metric">
        <div class="metric-label">TWR</div>
        <div class="metric-value" style="color:
          {% if analysis.advanced.thrust_ratio and analysis.advanced.thrust_ratio < 1.2 %}var(--red)
          {% elif analysis.advanced.thrust_ratio and analysis.advanced.thrust_ratio > 3 %}var(--gold)
          {% else %}var(--green){% endif %}">
          {% if analysis.advanced.thrust_ratio %}{{ analysis.advanced.thrust_ratio }}{% else %}‚Äî{% endif %}
        </div>
        <div class="muted small">{{ analysis.advanced.efficiency_class | default('') }}</div>
      </div>
      <div class="card-metric">
        <div class="metric-label">Motor Health</div>
        <div class="metric-value">{{ analysis.advanced.motor_health | default('‚Äî') }}</div>
      </div>
      <div class="card-metric">
        <div class="metric-label">Battery Health</div>
        <div class="metric-value">{{ analysis.advanced.battery_health | default('‚Äî') }}</div>
      </div>
    </div>

    {% if analysis.advanced.warnings_advanced %}
    <div class="warning-box" style="margin-top:12px;">
      {% for w in analysis.advanced.warnings_advanced %}
      <div class="alert {{ w.level | default('warning') }}">
        {% if w.level=='danger' %}‚ùå{% elif w.level=='warning' %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
        {{ w.msg }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if analysis.advanced.recommendations %}
    <h4 style="margin-top:14px;">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h4>
    <ul style="padding-left:18px;font-size:.87rem;">
      {% for r in analysis.advanced.recommendations %}
      <li style="margin-bottom:5px;">{{ r }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>

  <!-- Tab: Motor/KV -->
  <div id="tab-kv" class="tab-pane">
    <div style="padding:10px 0;">
      <h4>KV Suggestion</h4>
      <p style="font-size:1.05rem;font-weight:700;color:var(--blue);">{{ analysis.advanced.kv_suggestion | default('‚Äî') }}</p>
    </div>
    {% if analysis.advanced.prop_notes %}
    <h4>Prop Notes</h4>
    <ul style="padding-left:18px;font-size:.87rem;">
      {% for n in analysis.advanced.prop_notes %}
      <li>{{ n }}</li>
      {% else %}
      <li class="muted small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>

  <hr>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;">
    <button class="btn-small" onclick="copyAdvancedJSON()">üìã Copy JSON</button>
    <a class="btn-small" href="{{ url_for('downloads_index') }}">üìÇ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î DIFF</a>
  </div>

  <pre id="advancedJSON" style="display:none;">{{ analysis.advanced | tojson(indent=2) }}</pre>
</div>
{% endif %}

<!-- Drone Class + Baseline -->
{% if analysis.detected_class %}
<div class="result-card" style="border-left:3px solid var(--blue);">
  <h3 style="margin-top:0;display:flex;align-items:center;gap:8px;">
    üîé OBIX ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô
    <span class="class-badge">{{ analysis.detected_class }}</span>
  </h3>

  {% if analysis.class_meta.description %}
  <p style="color:var(--muted);font-size:.87rem;margin-bottom:14px;">
    {{ analysis.class_meta.description }}
  </p>
  {% endif %}

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
    <div>
      <h4>üéØ PID Baseline</h4>
      <pre id="pid-baseline">ROLL   P {{ analysis.pid_baseline.roll.p }}  I {{ analysis.pid_baseline.roll.i }}  D {{ analysis.pid_baseline.roll.d }}
PITCH  P {{ analysis.pid_baseline.pitch.p }} I {{ analysis.pid_baseline.pitch.i }} D {{ analysis.pid_baseline.pitch.d }}
YAW    P {{ analysis.pid_baseline.yaw.p }}  I {{ analysis.pid_baseline.yaw.i }}</pre>
      <button class="btn-small" style="margin-top:6px;" onclick="copyText('pid-baseline')">Copy PID Baseline</button>
    </div>
    <div>
      <h4>üîä Filter Baseline</h4>
      <pre id="filter-baseline">Gyro LPF2 : {{ analysis.filter_baseline.gyro_lpf2 }} Hz
D-Term LPF: {{ analysis.filter_baseline.dterm_lpf1 }} Hz
Dyn Notch : {{ analysis.filter_baseline.dyn_notch }}</pre>
      <button class="btn-small" style="margin-top:6px;" onclick="copyText('filter-baseline')">Copy Filter</button>
    </div>
  </div>

  <p style="margin-top:12px;font-size:.82rem;color:var(--muted);">
    ‚ö†Ô∏è ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ <strong style="color:var(--text);">‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</strong> ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô
  </p>
</div>
{% endif %}

<!-- Main Analysis: PID + Filter (Analyzed) -->
<div class="result-card">
  <h2>üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Style-based)</h2>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;">
    <div>
      <h3>‚öôÔ∏è PID ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
      <pre id="pid-main">ROLL   P {{ analysis.pid.roll.p }}  I {{ analysis.pid.roll.i }}  D {{ analysis.pid.roll.d }}
PITCH  P {{ analysis.pid.pitch.p }} I {{ analysis.pid.pitch.i }} D {{ analysis.pid.pitch.d }}
YAW    P {{ analysis.pid.yaw.p }}  I {{ analysis.pid.yaw.i }}</pre>
      <button class="btn-small" style="margin-top:6px;" onclick="copyText('pid-main')">Copy PID</button>
    </div>
    <div>
      <h3>üß† Filter ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
      <pre id="filter-main">Gyro LPF2 : {{ analysis.filter.gyro_lpf2 }} Hz
D-Term LPF: {{ analysis.filter.dterm_lpf1 }} Hz
Dyn Notch : {{ analysis.filter.dyn_notch }}</pre>
      <button class="btn-small" style="margin-top:6px;" onclick="copyText('filter-main')">Copy Filter</button>
    </div>
  </div>

  <!-- Prop Analysis -->
  <h3>üõ©Ô∏è ‡πÉ‡∏ö‡∏û‡∏±‡∏î</h3>
  <p style="color:var(--muted);font-size:.88rem;margin-bottom:8px;">{{ analysis.prop_result.summary }}</p>
  <div class="result-grid" style="grid-template-columns:repeat(3,1fr);gap:8px;">
    <div class="card-metric">
      <div class="metric-label">Noise</div>
      <div class="metric-value" style="color:
        {% if analysis.prop_result.effect.noise >= 7 %}var(--red)
        {% elif analysis.prop_result.effect.noise >= 5 %}var(--gold)
        {% else %}var(--green){% endif %}">
        {{ analysis.prop_result.effect.noise }}/8
      </div>
    </div>
    <div class="card-metric">
      <div class="metric-label">Motor Load</div>
      <div class="metric-value" style="color:
        {% if analysis.prop_result.effect.motor_load >= 5 %}var(--gold)
        {% else %}var(--green){% endif %}">
        {{ analysis.prop_result.effect.motor_load }}/6
      </div>
    </div>
    <div class="card-metric">
      <div class="metric-label">Grip</div>
      <div class="metric-value" style="font-size:.9rem;">{{ analysis.prop_result.effect.grip }}</div>
    </div>
  </div>
  <p style="font-size:.85rem;color:var(--blue);margin-top:8px;">
    üí° {{ analysis.prop_result.recommendation }}
  </p>

  <!-- Tips -->
  {% if analysis.basic_tips %}
  <h3>üìã Tips</h3>
  <ul style="padding-left:18px;">
    {% for tip in analysis.basic_tips %}
    <li style="font-size:.87rem;margin-bottom:5px;color:var(--muted);">{{ tip }}</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>

<!-- Preset CLI Box -->
<div class="result-card preset-box" style="border:1px solid rgba(88,166,255,0.12);">
  <h3 style="margin-top:0;color:var(--blue);">üéõ Preset ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
  <div class="preset-grid">
    <article class="preset-item preset-beginner">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
        <div style="width:40px;height:40px;border-radius:10px;background:var(--green-dim);display:grid;place-items:center;font-weight:800;color:var(--green);font-size:1.2rem;">B</div>
        <div>
          <h4 style="margin:0;">Beginner / Smooth</h4>
          <div class="muted small">‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà ‡∏ö‡∏¥‡∏ô‡∏ô‡∏¥‡πà‡∏á ‡∏Ñ‡∏∏‡∏°‡∏á‡πà‡∏≤‡∏¢</div>
        </div>
      </div>
      <ul>
        <li>Throttle limit: <strong>85%</strong></li>
        <li>Rates: ‡∏ï‡πà‡∏≥‚Äì‡∏Å‡∏•‡∏≤‡∏á | Filter: ‡∏ô‡∏∏‡πà‡∏°</li>
      </ul>
      <button class="btn-primary" style="margin-top:10px;width:100%;font-size:.83rem;" onclick="showPreset('beginner')">‡πÅ‡∏™‡∏î‡∏á CLI</button>
    </article>

    <article class="preset-item preset-freestyle">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
        <div style="width:40px;height:40px;border-radius:10px;background:var(--blue-dim);display:grid;place-items:center;font-weight:800;color:var(--blue);font-size:1.2rem;">F</div>
        <div>
          <h4 style="margin:0;">Freestyle</h4>
          <div class="muted small">‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡πÑ‡∏ß ‡∏Ñ‡∏∏‡∏°‡πÅ‡∏°‡πà‡∏ô</div>
        </div>
      </div>
      <ul>
        <li>Throttle: <strong>90‚Äì100%</strong></li>
        <li>Rates: ‡∏Å‡∏•‡∏≤‡∏á‚Äì‡∏™‡∏π‡∏á | Filter: ‡∏™‡∏°‡∏î‡∏∏‡∏•</li>
      </ul>
      <button class="btn-primary" style="margin-top:10px;width:100%;font-size:.83rem;background:var(--blue);color:#001133;" onclick="showPreset('freestyle')">‡πÅ‡∏™‡∏î‡∏á CLI</button>
    </article>

    <article class="preset-item preset-longrange">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
        <div style="width:40px;height:40px;border-radius:10px;background:rgba(201,166,255,0.1);display:grid;place-items:center;font-weight:800;color:#c9a6ff;font-size:1.2rem;">L</div>
        <div>
          <h4 style="margin:0;">Long-Range / Cinematic</h4>
          <div class="muted small">‡∏ô‡∏¥‡πà‡∏á ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü ‡∏•‡∏≠‡∏¢‡∏ô‡∏≤‡∏ô</div>
        </div>
      </div>
      <ul>
        <li>Throttle: <strong>80‚Äì85%</strong></li>
        <li>Rates: ‡∏ï‡πà‡∏≥ | Filter: ‡∏ô‡∏¥‡πà‡∏á</li>
      </ul>
      <button class="btn-primary" style="margin-top:10px;width:100%;font-size:.83rem;background:#7a52b0;color:#fff;" onclick="showPreset('longrange')">‡πÅ‡∏™‡∏î‡∏á CLI</button>
    </article>
  </div>

  <div class="cli-box" style="margin-top:16px;">
    <div class="cli-btns">
      <button class="btn-ghost" onclick="copyText('cliOutput')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å CLI</button>
    </div>
    <pre id="cliOutput" style="min-height:60px;"># ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å preset ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á CLI</pre>
  </div>
  <p class="preset-note">* Preset ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‚Äî ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
</div>

<!-- Charts -->
<div class="result-card">
  <h3 style="margin-top:0;">üìä Visualization</h3>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
    <div class="chart-wrap">
      <canvas id="thrustChart"></canvas>
    </div>
    <div class="chart-wrap">
      <canvas id="noiseChart"></canvas>
    </div>
  </div>
</div>

{% endif %}{# end if analysis #}

<!-- Community -->
<div class="community-box">
  <p class="community-text">
    <strong>OBIXConfig Doctor</strong> ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ üöß<br><br>
    ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏≠‡∏∞‡πÑ‡∏£? ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏´‡∏ô?<br>
    <span class="highlight">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à <strong>OBIXConfig Lab</strong></span><br><br>
    ‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏°‡∏ä‡∏ô FPV ‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‚ù§Ô∏è
  </p>
  <a href="https://www.facebook.com/banmysanti/" target="_blank" rel="noopener" class="community-btn">
    ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à OBIXConfig Lab
  </a>
</div>

<div class="version-note">OBIXConfig Doctor ‚Ä¢ v1.0.1beta ‚Äî Developed by FPV community üáπüá≠</div>

</div>{# end .container #}

<!-- ‚îÄ‚îÄ SCRIPTS ‚îÄ‚îÄ -->
<script>
// ‚îÄ‚îÄ Preset CLI data ‚îÄ‚îÄ
const presets = {
  beginner:`# OBIXConfig Lab - Beginner Preset
set throttle_limit_percent = 85
set dshot_bidir = OFF
set iterm_relax = RP
set feedforward_transition = 0
set anti_gravity_gain = 3
save`,
  freestyle:`# OBIXConfig Lab - Freestyle Preset
set throttle_limit_percent = 100
set iterm_relax = RPY
set feedforward_transition = 0.5
set anti_gravity_gain = 5
save`,
  longrange:`# OBIXConfig Lab - Long Range Preset
set throttle_limit_percent = 80
set iterm_relax = OFF
set feedforward_transition = 0
set anti_gravity_gain = 2
save`
};

function showPreset(type){
  var el = document.getElementById('cliOutput');
  if(el) el.textContent = presets[type] || '';
}

// ‚îÄ‚îÄ Preset autofill ‚îÄ‚îÄ
const presetMap = {
  "2.5_micro":   {size:2.5,  weight:80,   battery:"3S", prop_size:2.5, pitch:2.0, blades:"2", style:"freestyle"},
  "3_whoop":     {size:3.0,  weight:120,  battery:"3S", prop_size:3.0, pitch:2.0, blades:"2", style:"freestyle"},
  "3.5_cine":    {size:3.5,  weight:350,  battery:"4S", prop_size:3.5, pitch:2.5, blades:"2", style:"longrange"},
  "4_mini":      {size:4.0,  weight:420,  battery:"4S", prop_size:4.0, pitch:3.0, blades:"2", style:"freestyle"},
  "5_freestyle": {size:5.0,  weight:750,  battery:"4S", prop_size:5.0, pitch:4.0, blades:"3", style:"freestyle"},
  "6_heavy5":    {size:6.0,  weight:1000, battery:"6S", prop_size:6.0, pitch:4.0, blades:"3", style:"freestyle"},
  "7_midlr":     {size:7.0,  weight:1100, battery:"6S", prop_size:7.0, pitch:3.5, blades:"2", style:"longrange"},
  "7.5_midlr":   {size:7.5,  weight:1200, battery:"6S", prop_size:7.5, pitch:3.0, blades:"2", style:"longrange"},
  "8_lr":        {size:8.0,  weight:1500, battery:"6S", prop_size:8.0, pitch:3.5, blades:"2", style:"longrange"},
  "10_lr":       {size:10.0, weight:2200, battery:"6S", prop_size:10.0,pitch:4.5, blades:"2", style:"longrange"}
};

function setField(sel, val){
  var el = document.querySelector(sel);
  if(!el) return;
  el.value = val;
}

var psEl = document.getElementById('preset-select');
if(psEl){
  psEl.addEventListener('change', function(){
    var p = presetMap[this.value];
    if(!p) return;
    setField('input[name="size"]', p.size);
    setField('input[name="weight"]', p.weight);
    setField('select[name="battery"]', p.battery);
    setField('input[name="prop_size"]', p.prop_size);
    setField('input[name="pitch"]', p.pitch);
    setField('select[name="blades"]', p.blades);
    setField('select[name="style"]', p.style);
  });
}

// ‚îÄ‚îÄ Drawer (ONE implementation only) ‚îÄ‚îÄ
(function(){
  var btn = document.getElementById('hamburgerBtn');
  var drawer = document.getElementById('drawer');
  var overlay = document.getElementById('overlay');
  var closeBtn = document.getElementById('closeDrawer');

  function open(){
    btn && btn.setAttribute('aria-expanded','true');
    drawer && drawer.classList.add('open');
    drawer && drawer.removeAttribute('hidden');
    overlay && overlay.classList.add('open');
    overlay && overlay.setAttribute('aria-hidden','false');
    document.addEventListener('keydown', onEsc);
  }
  function close(){
    btn && btn.setAttribute('aria-expanded','false');
    drawer && drawer.classList.remove('open');
    overlay && overlay.classList.remove('open');
    overlay && overlay.setAttribute('aria-hidden','true');
    document.removeEventListener('keydown', onEsc);
    setTimeout(function(){ drawer && drawer.setAttribute('hidden',''); }, 260);
    btn && btn.focus();
  }
  function onEsc(e){ if(e.key==='Escape') close(); }

  btn && btn.addEventListener('click', function(){
    btn.getAttribute('aria-expanded')==='true' ? close() : open();
  });
  overlay && overlay.addEventListener('click', close);
  closeBtn && closeBtn.addEventListener('click', close);

  // responsive
  window.addEventListener('resize', function(){
    if(window.innerWidth > 900){
      drawer && drawer.removeAttribute('hidden');
    } else if(!drawer.classList.contains('open')){
      drawer && drawer.setAttribute('hidden','');
    }
  });
  if(window.innerWidth <= 900 && drawer) drawer.setAttribute('hidden','');
})();

// ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ
function switchTab(btn, paneId){
  var tabs = btn.closest('.result-card').querySelectorAll('.tab-btn');
  var panes = btn.closest('.result-card').querySelectorAll('.tab-pane');
  tabs.forEach(function(t){ t.classList.remove('active'); });
  panes.forEach(function(p){ p.classList.remove('active'); });
  btn.classList.add('active');
  var pane = document.getElementById(paneId);
  if(pane) pane.classList.add('active');
}

// ‚îÄ‚îÄ Advanced JSON copy ‚îÄ‚îÄ
function copyAdvancedJSON(){
  var el = document.getElementById('advancedJSON');
  if(el) navigator.clipboard.writeText(el.innerText).then(function(){ showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úì'); });
}

// ‚îÄ‚îÄ Charts ‚îÄ‚îÄ
{% if analysis %}
(function(){
  var thrustEl = document.getElementById('thrustChart');
  if(thrustEl){
    new Chart(thrustEl, {
      type: 'bar',
      data: {
        labels: ['Thrust-to-Weight Ratio'],
        datasets: [{
          label: 'TWR',
          data: [{{ analysis.thrust_ratio or 0 }}],
          backgroundColor: ['rgba(16,196,122,0.5)'],
          borderColor: ['#10c47a'],
          borderWidth: 1,
          borderRadius: 6
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, max: 5,
               grid: { color: 'rgba(255,255,255,0.04)' },
               ticks: { color: '#8a99a8' } },
          x: { grid: { display: false }, ticks: { color: '#8a99a8' } }
        }
      }
    });
  }

  var noiseEl = document.getElementById('noiseChart');
  if(noiseEl){
    new Chart(noiseEl, {
      type: 'radar',
      data: {
        labels: ['Motor Load', 'Noise', 'Grip'],
        datasets: [{
          label: 'Prop Profile',
          data: [
            {{ analysis.prop_result.effect.motor_load }},
            {{ analysis.prop_result.effect.noise }},
            {% if analysis.prop_result.effect.grip == '‡∏´‡∏ô‡∏∂‡∏ö‡∏°‡∏≤‡∏Å' %}6
            {% elif analysis.prop_result.effect.grip == '‡∏´‡∏ô‡∏∂‡∏ö‡∏î‡∏µ' %}4
            {% else %}2{% endif %}
          ],
          backgroundColor: 'rgba(88,166,255,0.15)',
          borderColor: '#58a6ff',
          pointBackgroundColor: '#58a6ff',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          r: {
            beginAtZero: true, max: 8,
            grid: { color: 'rgba(255,255,255,0.06)' },
            ticks: { display: false },
            pointLabels: { color: '#8a99a8', font: { size: 11 } }
          }
        }
      }
    });
  }
})();
{% endif %}
</script>

</body>
</html>
